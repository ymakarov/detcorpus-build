# Общие замечания про docker

Docker я использовал для запуска на своей машине manatee и bonito.  
Docker работает под Linux, Windows и MacOS. 
В Linux установить Docker можно по [инструкции](https://docs.docker.com/v17.12/install/). 
При этом на компьютере появится docker демон, который может собирать и запускать образы.
Образы это наборы программного обеспечения. 

## Создание образа
Образ описывается в файле со специальным названием Dockerfile. 
Файл содержит набор [инструкций](https://docs.docker.com/engine/reference/builder/).
После создания Dockerfile образ собирается с помощью [команды](https://docs.docker.com/engine/reference/commandline/build/) ```docker build```. 
Эта команда подготавливает образ и складывает его в локальный репозиторий для дальнейшего использования.

## Запуск образов
Образы запускаются [командой](https://docs.docker.com/engine/reference/run/) ```docker run```.
Я использовал 2 режима запуска: 
- с подключением к контейнеру и возможностью работать в образе ```docker run -it```
- в фоне, для запуска веб сервера ```docker run -d```

Если образ запущен в фоне, к нему можно подключиться с помощью ```docker exec```([инструкция](https://docs.docker.com/engine/reference/commandline/exec/)).

# Индексация корпуса в docker

В папке ```detcorpus-build/docker/index``` лежит описание и необходимые файлы для сборки образа, в котором можно индексировать корпус.
Непосредственно сборку образа можно сделать с помощью ```detcorpus-build/docker/bin/build-image```. 
В этом скрипте создается временная папка ```build``` наполняется необходимыми данными для создания образа и запускается:
```
docker build -t manatee-index .
```
Эта команда создает локально образ с тегом ```manatee-index```.
Далее в этом образе можно производить индексацию ```detcorpus-build/docker/bin/docker-make-index```:
```
docker run -v $1:/home/detcorpus -v $2:/home/out manatee-index 
```
```run``` запускает образ и выполняет команду из Dockerfile.
Параметр ```-v``` позволяет маунтить папку с ОС пользователя в docker образ. Указывается полный путь до папки на компьютере и полный путь в образе.

## Запуск веб сервера с построенным индексом

- Создаем docker образ:

```
cd docker/web
docker build -t manatee-web .
```

- Запускаем его и делаем доступным на 80 порту

```
bin/docker-web /tmp/out
```

Входной параметр - полный путь до директории, где лежит распакованный файл с экспортом.

Контайнер запустится в detached режиме и к нему можно будет подключиться командой:

```
docker exec -it [имя контейнерa] /bin/bash
```

Имя контейнера можно узнать командой:

```
docker ps
```
