# Общие замечания про docker

Docker я использовал для запуска на своей машине manatee и bonito.  
Docker работает под Linux, Windows и MacOS. 
В Linux установить Docker можно по [инструкции](https://docs.docker.com/v17.12/install/). 
При этом на компьютере появится docker демон, который может собирать и запускать образы.
Образы это наборы программного обеспечения. 

## Создание образа
Образ описывается в файле со специальным названием Dockerfile. 
Файл содержит набор [инструкций](https://docs.docker.com/engine/reference/builder/).
После создания Dockerfile образ собирается с помощью [команды](https://docs.docker.com/engine/reference/commandline/build/) ```docker build```. 
Эта команда подготавливает образ и складывает его в локальный репозиторий для дальнейшего использования.

## Запуск образов
Образы запускаются [командой](https://docs.docker.com/engine/reference/run/) ```docker run```.
Я использовал 2 режима запуска: 
- с подключением к контейнеру и возможностью работать в образе ```docker run -it```
- в фоне, для запуска веб сервера ```docker run -d```

Если образ запущен в фоне, к нему можно подключиться с помощью ```docker exec```([инструкция](https://docs.docker.com/engine/reference/commandline/exec/)).



# Сборка и запуск корпуса в docker #

## Индексация корпуса ##


- Создание docker образа для индексации текстов:

```
bin/build-image
```

- Индексация текстов 

```
bin/docker-make-index /tmp/in /tmp/out
```

Скрипт принимает два параметра. В первом директория откуда брать файлы. Во втором директория, куда класть архив с индексом.

## Запуск веб сервера с построенным индексом ##

- Создаем docker образ:

```
cd docker/web
docker build -t manatee-web .
```

- Запускаем его и делаем доступным на 80 порту

```
bin/docker-web /tmp/out
```

Входной параметр - полный путь до директории, где лежит распакованный файл с экспортом.

Контайнер запустится в detached режиме и к нему можно будет подключиться командой:

```
docker exec -it [имя контейнерa] /bin/bash
```

Имя контейнера можно узнать командой:

```
docker ps
```
